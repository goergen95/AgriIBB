algo_selec = algo_cmd[c(1:2,9:10,15,28,29)] # for watershed
#algo_selec = algo_cmd[c(1:7,15,28,29)] # for meanshift raster
#algo_selec = algo_cmd[c(1:7,15:17,19:26,29)]
algo_selec
command<-paste0(otb$pathOTB,"otbcli_",otb_algorithm," ")
command<-paste(command,paste(names(algo_selec),algo_selec,collapse = " "))
system(command,intern = TRUE)
r = raster(paste0(path_morph_run,"seg_lrm.tif"))
#s = rasterToPolygons(r)
#plot(s)
plot(r)
algo_cmd$`-filter.watershed.level` = "0.4"
algo_cmd$`-filter.watershed.threshold` = "0.1"
algo_selec = algo_cmd[c(1:2,9:10,15,28,29)] # for watershed
command<-paste0(otb$pathOTB,"otbcli_",otb_algorithm," ")
#algo_selec = algo_cmd[c(1:7,15,28,29)] # for meanshift raster
#algo_selec = algo_cmd[c(1:7,15:17,19:26,29)]
algo_selec
command<-paste(command,paste(names(algo_selec),algo_selec,collapse = " "))
system(command,intern = TRUE)
r = raster(paste0(path_morph_run,"seg_lrm.tif"))
#s = rasterToPolygons(r)
#plot(s)
plot(r)
algo_cmd$`-filter.watershed.threshold` = "0.01"
algo_selec = algo_cmd[c(1:2,9:10,15,28,29)] # for watershed
#algo_selec = algo_cmd[c(1:7,15,28,29)] # for meanshift raster
#algo_selec = algo_cmd[c(1:7,15:17,19:26,29)]
algo_selec
command<-paste0(otb$pathOTB,"otbcli_",otb_algorithm," ")
command<-paste(command,paste(names(algo_selec),algo_selec,collapse = " "))
system(command,intern = TRUE)
r = raster(paste0(path_morph_run,"seg_lrm.tif"))
#s = rasterToPolygons(r)
#plot(s)
plot(r)
algo_cmd$`-filter.watershed.threshold` = "0.00001"
#algo_selec = algo_cmd[c(1:7,15,28,29)] # for meanshift raster
#algo_selec = algo_cmd[c(1:7,15:17,19:26,29)]
algo_selec
algo_selec = algo_cmd[c(1:2,9:10,15,28,29)] # for watershed
#algo_selec = algo_cmd[c(1:7,15,28,29)] # for meanshift raster
#algo_selec = algo_cmd[c(1:7,15:17,19:26,29)]
algo_selec
command<-paste(command,paste(names(algo_selec),algo_selec,collapse = " "))
command<-paste0(otb$pathOTB,"otbcli_",otb_algorithm," ")
system(command,intern = TRUE)
r = raster(paste0(path_morph_run,"seg_lrm.tif"))
#s = rasterToPolygons(r)
#plot(s)
plot(r)
algo_selec
algo_cmd$`-filter.watershed.threshold` = "0.0001"
algo_selec = algo_cmd[c(1:2,9:10,15,28,29)] # for watershed
command<-paste0(otb$pathOTB,"otbcli_",otb_algorithm," ")
command<-paste(command,paste(names(algo_selec),algo_selec,collapse = " "))
system(command,intern = TRUE)
r = raster(paste0(path_morph_run,"seg_lrm.tif"))
#s = rasterToPolygons(r)
#plot(s)
plot(r)
c2 = c(160,295,387,529,421,254,159,143,129,127,125,124)
c0 = 124
t = 36
V = 1
ctest = c2 - c0
integrate(ctest)
diffinv(ctest)
diffinv(ctest, lag = 36)
diffinv(ctest, lag = 12)
diffinv(ctest, lag = 1)
diffinv(ctest, differences = 12 )
?cumsum
c2 = c(160,295,387,529,421,254,159,143,129,127,125,124)
t = c(seq(0,36,3))
t
t = c(seq(3,36,3))
c0 = 124
ctest = c2 - c0
cumsum(c2*diff(t))
diff(t)
x = diff(t)
t = c(seq(0,36,3))
cumsum(c2*diff(t))
cumsum(c2*diff(t))[1]
f = function(C2t,C0){
C2t-C0
}
?integrate
f = function(C2t,C0){
c2-C0
}
Q = (V*C1) / integrat(f(c2,c0), lower = 0,upper = 36)
c2 = c(160,295,387,529,421,254,159,143,129,127,125,124)
c0 = 124
t = c(seq(0,36,3))
V = 1
C1 = 300 #mg/l
V = 1 #l
f = function(C2t,C0){
C2t-C0
}
Q = (V*C1) / integrat(f(c2,c0), lower = 0,upper = 36)
Q = (V*C1) / integrate(f(c2,c0), lower = 0,upper = 36)
Q = (V*C1) / integrate(f, lower = 0,upper = 36)
f = function(x){
x-124
}
Q = (V*C1) / integrate(f, lower = 0,upper = 36)
ctest
plot(ctest,type= "l")
f = function(x){
c2-c0
}
Q = m / integrate(f, lower = 0,upper = 36)
m = 30 #mg/l
Q = m / integrate(f, lower = 0,upper = 36)
integrate(f, lower = 0,upper = 36)
f = function(x){
ctest
}
Q = m / integrate(f, lower = 0,upper = 36)
Q = m / ctest
Q
c2
c0
ctest
Q = sum(m / ctest)
Q
ctest[12]=0
Q = sum(m/ctest)
Q
ctest = c2 - c0
ctest[12]=0
m/ctest
int = m/ctest
int[12]=0
sum(int)
m = 529 #mg/l
int = m/ctest
int[12]=0
sum(int)
sum(c2-c0)
int = sum(c2-c0)
Q = (V*Ci)/int
Ci = 30 #g/l
Q = (V*Ci)/int
Q
c2i = c(174,585,686,425,202,162,136,131,129,128,127,127,127,126,126,126,124)
int2 = sum(c2i-c0)
Q2 = (V*Ci)/int2
conc =function(x){
C = 0.0005*x-0.1413
return(C)
}
conc(c2)
conc(c2i)
tub = 0
inflow = 10 # in liters per minute
outflow = 0.5 * tub
for (i in 1:10){
tub = tub + inflow
outflow = 0.5*tub
tub = tub - outflow
print(paste0("The water in the tub after minute ",i," is ",tub))
}
f = function(x){-0.5x + 10x}
f = function(x){-0.5*x + 10*x}
integrate(f,lower = 0,upper = 10)
f = function(x){10*x-0.5x}
f = function(x){10*x-0.5*x}
integrate(f,lower = 0,upper = 10)
integrate(f,lower = 0,upper = 1)
integrate(f,lower = 0,upper = 10)
f
library(tidyverse)
install.packages("tidyverse")
library(tidyverse)
mpg
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy))
?ggplot
length(mpg$hwy)
unique(mpg$displ)
liters = unique(mpg$displ)
average = c()
for (i in liters){
m = mean(mpg$hwy[mpg$displ==i])
append(average,m)
}
for (i in 1:length(liters)){
average[i] = mean(mpg$hwy[mpg$displ==liters[i]])
}
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy))+
geom_line(data=average)
displAv = data.frame(displ=liters,hwy=average)
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy))+
geom_line(data=displAv, mapping=aes(x=displ,y=hwy))
mod = lm(hwy~displ, data=displAv)
mod
min(liters)
x = seq(0,7,0.5)
y = predict(mod,x)
f = function(x){-2.849*x+33.855}
y = lapply(x,f)
y
y = unlist(lapply(x,f))
y
x = seq(0,7,0.25)
f = function(x){-2.849*x+33.855}
y = unlist(lapply(x,f))
x = seq(0,7,0.2)
f = function(x){-2.849*x+33.855}
y = unlist(lapply(x,f))
x = seq(0,7,0.1)
x = seq(0,7,0.21)
f = function(x){-2.849*x+33.855}
y = unlist(lapply(x,f))
x = seq(0,7,0.22)
f = function(x){-2.849*x+33.855}
y = unlist(lapply(x,f))
x = seq(0,7,0.23)
x = seq(0,7,0.19)
x = seq(0,7,0.2)
f = function(x){-2.849*x+33.855}
x = seq(0,7,0.198)
x = seq(0,7,0.195)
x = seq(0,7,0.194)
x = seq(0,8,0.2)
f = function(x){-2.849*x+33.855}
x = seq(0,8,0.25)
x = seq(0,8,0.225)
x = seq(0,8,0.22)
x = seq(0,8,0.21)
x = seq(0,8,0.23)
f = function(x){-2.849*x+33.855}
y = unlist(lapply(x,f))
y
displAv$lin = y
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy))+
geom_line(data=displAv, mapping=aes(x=displ,y=lin))
y = unlist(lapply(displAv$displ,f))
displAv$lin = y
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy))+
geom_line(data=displAv, mapping=aes(x=displ,y=lin))
mod
ggplot(data=mpg)+
geom_point(mapping = aes(x=cyl, y=hwy))+
ggplot(data=mpg)+
geom_point(mapping = aes(x=cyl, y=hwy))
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy, color=class))
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy, color=class, size=cyl))
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy, color=class, alpha=cyl))
mpg
ggplot(data=mpg)+
geom_point(mapping = aes(x=displ, y=hwy, color=class, alpha=year, shape=fl))
devtools::install_github("rstudio/keras")
library(keras)
_install_keras()
?install_keras()
library(rgdal)
# script to achieve an automated stratified random sampling
library(rgdal)
library(gdalUtils)
library(rgeos)
library(mapview)
library(sp)
library(maptools)
fields = readOGR("F:/R/results/shapes/agri_area_single.shp")
fields$id = 1:length(fields)
provinces = readOGR("F:/R/results/shapes/adm_1_2_balchasch_alakol.shp")
provinces = provinces[is.na(provinces$HASC_1),]
provinces@data = provinces@data[,c(2,5,14)]
provinces@data$NAME_1 = as.character(provinces@data$NAME_1)
provinces@data$NAME_2 = as.character(provinces@data$NAME_2)
centroids = gCentroid(fields, byid = TRUE)
contained = gContains(provinces,centroids, byid = TRUE)
index = apply(contained,1,function(x){
return(which(x == TRUE))
})
index = as.vector(unlist(index))
provNames = provinces@data$NAME_2
fields$province = provNames[index]
fields$area = gArea(fields,byid = TRUE)
df = data.frame(prov = provNames,area=0, perc = 0,pixels=0)
for(province in provNames){
df$area[df$prov==province] = sum(fields$area[fields$province==province])
}
df$perc = df$area / sum(df$area)
df$pixels = round(2000 * df$perc)
randomPoints = lapply(provNames, function(x){
if(length(fields[which(fields$province==x),])==0) return(NULL)
tmp = spsample(fields[which(fields$province==x),],n=df$pixels[df$prov==x],"stratified")
return(tmp)
})
set.seed(123920)
randomPoints = lapply(provNames, function(x){
if(length(fields[which(fields$province==x),])==0) return(NULL)
tmp = spsample(fields[which(fields$province==x),],n=df$pixels[df$prov==x],"stratified")
return(tmp)
})
compact = function(x) Filter(Negate(is.null),x)
randomPoints = compact(randomPoints)
tmp = randomPoints[[1]]
for(i in 2:length(randomPoints)){
tmp = spRbind(tmp,randomPoints[[i]])
}
randomPoints = SpatialPointsDataFrame(tmp, data.frame(id=1:length(tmp)))
buffer = gBuffer(randomPoints,byid = TRUE, width = 750)
mapview(buffer)
r = raster("B:/ibb/results/clean/NDVI_2003001.tif")
r
r = raster::raster("B:/ibb/results/clean/NDVI_2003001.tif")
r
fields$area = gArea(fields,byid = TRUE, width = 0.001475257*3)#width is 3 times pixel resolution
buffer = gBuffer(randomPoints,byid = TRUE, width = 0.001475257*3)#width is 3 times pixel resolution)
mapview(buffer)
writeOGR(buffer, dsn = "B:/ibb/results/shapes/buffer.shp",layer = "buffer",overwrite_layer = TRUE, driver ="ESRI Shapefile")
buffer = gBuffer(randomPoints,byid = TRUE, width = 0.001475257*6)#width is 3 times pixel resolution)
writeOGR(buffer, dsn = "B:/ibb/results/shapes/buffer.shp",layer = "buffer",overwrite_layer = TRUE, driver ="ESRI Shapefile")
buffer = gBuffer(randomPoints,byid = TRUE, width = 0.001475257*5)#width is 3 times pixel resolution)
writeOGR(buffer, dsn = "B:/ibb/results/shapes/buffer.shp",layer = "buffer",overwrite_layer = TRUE, driver ="ESRI Shapefile")
buffer = gBuffer(randomPoints,byid = TRUE, width = 0.001475257*4)#width is 3 times pixel resolution)
writeOGR(buffer, dsn = "B:/ibb/results/shapes/buffer.shp",layer = "buffer",overwrite_layer = TRUE, driver ="ESRI Shapefile")
buffer = gBuffer(randomPoints,byid = TRUE, width = 0.001475257*4.5)#width is 3 times pixel resolution)
writeOGR(buffer, dsn = "B:/ibb/results/shapes/buffer.shp",layer = "buffer",overwrite_layer = TRUE, driver ="ESRI Shapefile")
touch = gIntersects(buffer)
touch = gIntersects(buffer, byid = TRUE)
touch
?gIntersects
notouch = gDisjoint(buffer, byid = TRUE)
notouch
rm(touch)
unique(touch)
unique(notouch)
summary(notouvh)
summary(notouch)
dim(notouch)
notuch[1,1]
notouch[1,1]
index = apply(notouch,1,function(x){
return(sum(x))
})
index
index = as.vector(unlist(index))
index
unique(index)
index = apply(notouch,1,function(x){
return(sum(x))
})
sum(notouch[1,])
sum(notouch[,1])
notouch[1,]
index = apply(notouch,1,function(x){
return(sum(x))
})
index = as.vector(unlist(index))
which(index==2047)
plot(randomPoints[c(33,34)])
plot(randomPoints[c(33,34),])
mapview(randomPoints[c(33,34),])
mapview(randomPoints[c(62,71),])
randomPoints
which(index==2047)
which(index==2047)[seq(1,which(index==2047),2)]
which(index==2047)[seq(1,length(which(index==2047)),2)]
randomPoints[-which(index==2047)[seq(1,length(which(index==2047)),2)],]
randomPoints[-which(index==2047)[seq(1,length(which(index==2047)),2)],]
randomPoints = randomPoints[-which(index==2047)[seq(1,length(which(index==2047)),2)],]
buffer = gBuffer(randomPoints,byid = TRUE, width = 0.001475257*4.5)#width is 3 times pixel resolution)
notouch = gDisjoint(buffer, byid = TRUE)
index = apply(notouch,1,function(x){
return(sum(x))
})
index = as.vector(unlist(index))
unique(index)
gDisjoint()
?gDisjoint()
set.seed(123920)
randomPoints = lapply(provNames, function(x){
if(length(fields[which(fields$province==x),])==0) return(NULL)
tmp = spsample(fields[which(fields$province==x),],n=df$pixels[df$prov==x],"stratified")
return(tmp)
})
compact = function(x) Filter(Negate(is.null),x)
randomPoints = compact(randomPoints)
tmp = randomPoints[[1]]
for(i in 2:length(randomPoints)){
tmp = spRbind(tmp,randomPoints[[i]])
}
randomPoints = SpatialPointsDataFrame(tmp, data.frame(id=1:length(tmp)))
buffer = gBuffer(randomPoints,byid = TRUE, width = 0.001475257*4.5)#width is 3 times pixel resolution)
notouch = gDisjoint(buffer, byid = TRUE)
index = apply(notouch,1,function(x){
return(sum(x))
})
index = as.vector(unlist(index))
index = which(index==2047
index
index = which(index==2047)
index
notouch[index,]
which(!notouch)
which(notouch)
which(!notouch)
dim(which(!notouch))
index = apply(notouch,1,function(x){
return(which(x == FALSE))
})
index
index = as.vector(unlist(index))
index
randomPoints
index = apply(notouch,1,function(x){
if (sum(x)==0)return(0)
if (sum(x)>0)return(which(x)==FALSE)
})
index
notouch = gIntersect(buffer, byid = TRUE)
touch = gIntersects(buffer, byid = TRUE)
sum(touch[1,])
sum(touch[2,])
sum(touch[3,])
as.vector(touch[3,])
as.vector(touch[1,])
sum(touch[2,])
sum(touch[4,])
sum(touch[5,])
sum(touch[500,])
index = apply(touch,1,function(x){
if (sum(x)==1)return(0)
if (sum(x)>1)return(which(x)==TRUE)
})
index
index = as.vector(unlist(index))
index
which(index!=0)
index = apply(touch,1,function(x){
if (sum(x)==1)return(0)
if (sum(x)>1)return(which(x==TRUE))
})
index = as.vector(unlist(index))
which(index!=0)
index
?spsample
df$pixels = round(2500 * df$perc)
set.seed(123920)
randomPoints = lapply(provNames, function(x){
if(length(fields[which(fields$province==x),])==0) return(NULL)
tmp = spsample(fields[which(fields$province==x),],n=df$pixels[df$prov==x],"stratified")
return(tmp)
})
compact = function(x) Filter(Negate(is.null),x)
randomPoints = compact(randomPoints)
tmp = randomPoints[[1]]
for(i in 2:length(randomPoints)){
tmp = spRbind(tmp,randomPoints[[i]])
}
randomPoints = SpatialPointsDataFrame(tmp, data.frame(id=1:length(tmp)))
buffer = gBuffer(randomPoints,byid = TRUE, width = 0.001475257*4.5)#width is 3 times pixel resolution)
touch = gIntersects(buffer, byid = TRUE)
index = apply(touch,1,function(x){
if (sum(x)==1)return(0)
if (sum(x)>1)return(which(x==TRUE))
})
index = as.vector(unlist(index))
index
index = which(index!=0)
index
randomPoints = randomPoints[-index,]
randomPoints
writeOGR(tmp, dsn = "B:/ibb/results/shapes/random_points.shp",layer = "random_points",overwrite_layer = TRUE, driver ="ESRI Shapefile")
randomPoints = SpatialPointsDataFrame(randomPoints, data.frame(id=1:length(tmp)))
randomPoints = SpatialPointsDataFrame(randomPoints, data.frame(id=1:length(randomPoints)))
randomPoints
writeOGR(tmp, dsn = "B:/ibb/results/shapes/random_points.shp",layer = "random_points",overwrite_layer = TRUE, driver ="ESRI Shapefile")
writeOGR(tmp, dsn = "B:/ibb/results/shapes/random_points.shp",layer = "random_points",overwrite_layer = TRUE, driver ="ESRI Shapefile")
writeOGR(random, dsn = "B:/ibb/results/shapes/random_points.shp",layer = "random_points",overwrite_layer = TRUE, driver ="ESRI Shapefile")
writeOGR(randomPoints, dsn = "B:/ibb/results/shapes/random_points.shp",layer = "random_points",overwrite_layer = TRUE, driver ="ESRI Shapefile")
df
write.csv(df,"B:/ibb/results/randomSample.csv")
writeOGR(buffer, dsn = "B:/ibb/results/shapes/buffer.shp",layer = "buffer",overwrite_layer = TRUE, driver ="ESRI Shapefile")
install.packages("rater")
install.packages("raster")
library(raster)
first2016 = brick("B:/ibb/results/savG/savG_First2_2016.tif")
second2016 = brick("B:/ibb/results/savG/savG_Second2_2016.tif")
?merge
library(raster)
second2016 = brick("B:/ibb/results/savG/savG_Second2_2016.tif")
first2016 = brick("B:/ibb/results/savG/savG_First2_2016.tif")
?merge
t = merge(first2016,second2016)
t = mosaic(first2016,second2016)
second2016 = brick("B:/ibb/results/savG/savG_2003.tif")
library(raster)
second2016 = brick("B:/ibb/results/savG/savG_2003.tif")
second2016
plot(second2016[1],type = "l")
plot(as.numeric(second2016[1]),type = "l")
setwd("B:/ibb/AgriIBB/")
rfMod = readRDS("../results/prediction/rfModel.rds")
confMat = readRDS("../results/prediction/confMat.rds")
condMat
confMat
